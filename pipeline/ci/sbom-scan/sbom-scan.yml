syft-scan:
  stage: sbom scan
  needs: [initialize-job]
  services:
    - name: docker:26.1.3-dind
      alias: docker-dind-syft
  variables:
    DOCKER_HOST: tcp://docker-dind-syft:2375/
  script:
    - mkdir -p reports
    - docker run --rm quay.io/bastiaanvanderbijl/syft $IMAGE_NAME:$IMAGE_TAG --scope all-layers -o json > reports/syft-report.json
  artifacts:
    paths:
      - reports/
  allow_failure: false
